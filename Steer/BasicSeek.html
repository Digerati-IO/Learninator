<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="viewport" content="width=1024">
    <title>Basic Seek</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css"/>
    <script src="js/box2d.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/3.0.11/pixi.min.js"></script>
    <script src="../js/lib/external/steer.js"></script>
    <script src="js/controlHelper.js"></script>
</head>
<body onload="initScene();">

<div id="mainView" style=" height:660px; margin-top: -330px;">
    <div id="divScreen" style="border-radius:4px;"></div>
    <div id="steerLogo"></div>
</div>

<script type="text/javascript">

    // 點選 some 拖曳 the time of acquisition mainView Nameranezumi coordinate
    var mousePt = {x: 0, y: 0};
    function mouseMoveCall(e) {
        mouseUpdate(e);
    }
    document.addEventListener("mousedown", function (e) {
        mouseUpdate(e);
        document.addEventListener("mousemove", mouseMoveCall);
    });
    document.addEventListener("mouseup", function (e) {
        document.removeEventListener("mousemove", mouseMoveCall);
    });
    document.addEventListener("touchstart", mouseUpdate);
    document.addEventListener("touchmove", mouseUpdate);
    function mouseMoveCall(e) { mouseUpdate(e); }
    document.addEventListener("mousedown", function (e) {
        mouseUpdate(e);
        document.addEventListener("mousemove", mouseMoveCall);
    });
    document.addEventListener("mouseup", function (e) { document.removeEventListener("mousemove", mouseMoveCall); });
    document.addEventListener("touchstart", mouseUpdate);
    document.addEventListener("touchmove", mouseUpdate);
    function mouseUpdate(e) {
        if (e.changedTouches) {
            mousePt.x = (e.changedTouches[0].clientX - document.getElementById("mainView").offsetLeft) / 30;
            mousePt.y = (e.changedTouches[0].clientY - document.getElementById("mainView").offsetTop) / 30;
        } else if (e.pageX) {
            mousePt.x = (e.pageX - document.getElementById("mainView").offsetLeft) / 30;
            mousePt.y = (e.pageY - document.getElementById("mainView").offsetTop) / 30;
        }
        e.preventDefault();
    }


    function initScene() {
        // Erected pixi environment, domain 以及 Creator specified Domain
        var pixiRenderer = PIXI.autoDetectRenderer(1024, 660, { antialias: true, transparent: true, resolution: 1 });
        document.getElementById("divScreen").appendChild(pixiRenderer.view);
        var pixiStage = new PIXI.Stage(0xFFFFFF, false);
        var domain = new steer.Domain();
        domain.createB2World(new box2d.b2Vec2(0, 0));
        var pixiDR = new steer.render.PixiDebugRenderer(domain, pixiStage, pixiRenderer, 900, 700);
        // Domain join dividing 錯顯 shows Render
        domain.addRenderer(pixiDR);

        steer.item.Creator.setDomainReference(domain);
        steer.item.Creator.pixelCreateFormat = true;

        var createInfo = { x: 200, y: 200, radius: 20, maxForce: 2, maxSpeed: 10, dynamic: true };
        var newUnit = steer.item.Creator.createUnit(createInfo);
        // Unit dividing 錯顯 show set
        var ddinfo = steer.render.DebugDrawInfo.create(newUnit);
        // E-made unit front line stage projection, gave setting unit 顏色
        ddinfo.drawMask = steer.render.DebugDrawInfo.UNIT_RAYCAST;
        ddinfo.color = 0xFF6633;


        // Erected SteerTimer setting update frequent rate of 30 FPS
        var myTimer = new steer.SteerTimer(30);

        // Set 每次 mathematical operation during LOGIC_UPDATE when updating mathematical operation (此範 example for 每秒 30 order)
        myTimer.addEvent(steer.Event.LOGIC_UPDATE, function (e) {
            // Delta Kinono 每次 update time difference
            var delta = e.values.delta;

            // Standing update responsibility what the pre-operation setting domain.preUpdate () (purpose for (DVD) (DTS Version) available basis 參數, 增加 mathematical operation Efficacy)
            domain.preUpdate();

            // Transmission steer.controls.Behavior property setting Unit add 蹤 Nameranezumi work targets (seek behavior)
            var seekForce = steer.controls.Behavior.seek(newUnit, mousePt);
            newUnit.applyForce(seekForce);

            // Update domain 帶入 每次 update time difference, transparent 經過 time 做為 move large and small manner Yo據
            domain.update(delta);
        });

        // Set 畫面 update mathematical operation RENDER_UPDATE (每秒 60 order)
        myTimer.addEvent(steer.Event.RENDER_UPDATE, function (e) {
            var delta = e.values.delta;
            // Domain in ownership Renderer update MiSatoru
            domain.integrate(delta);

            // Error made 點下 coordinates (Tadakyo paradigm Akira 示及 dividing complex)
            pixiDR.guideGraphic.clear();
            pixiDR.drawDot(mousePt, 0x99CC99, 1, 0.5);

        });

        // SteerTimer start mathematical operation
        myTimer.start();

    }

</script>

</body>

</html>
