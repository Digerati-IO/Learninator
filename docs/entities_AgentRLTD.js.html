<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: entities/AgentRLTD.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: entities/AgentRLTD.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var AgentRLTD = AgentRLTD || {},
    Agent = Agent || {},
    Utility = Utility || {};

(function (global) {
    "use strict";

    /**
     * Initialize the AgentRLTD
     * @name AgentRLTD
     * @extends Agent
     * @constructor
     *
     * @param {Vec} position - The x, y location
     * @param {agentOpts} opts - The Agent options
     * @returns {AgentRLTD}
     */
    function AgentRLTD(position, opts) {
        Agent.call(this, position, opts);

        this.nStepsHistory = [];
        this.nStepsCounter = 0;
        this.nflot = 1000;
        this.score = 0;

        this.brainOpts = Utility.getOpt(opts, 'spec', {
            update: 'qlearn', // 'qlearn' or 'sarsa'
            gamma: 0.9, // discount factor, [0, 1)
            epsilon: 0.2, // initial epsilon for epsilon-greedy policy, [0, 1)
            alpha: 0.1, // value function learning rate
            lambda: 0.9, // eligibility trace decay, [0,1). 0 = no eligibility traces
            replacingTraces: true, // use replacing or accumulating traces
            planN: 50, // number of planning steps per iteration. 0 = no planning
            smoothPolicyUpdate: true, // non-standard, updates policy smoothly to follow max_a Q
            beta: 0.1 // learning rate for smooth policy update
        });

        this.reset();
    }

    AgentRLTD.prototype = Object.create(Agent.prototype);
    AgentRLTD.prototype.constructor = Agent;

    AgentRLTD.prototype.reset = function () {
        let self = this;
        if (!this.worker) {
            this.brain = new TDAgent(this.env, this.brainOpts);
            this.state = this.env.startState();

            this.env.reset();

            return this;
        } else {
            this.post = function (cmd, input) {
                this.brain.postMessage({target: 'TD', cmd: cmd, input: input});
            };

            let jEnv = Utility.stringify(self.env),
                jOpts = Utility.stringify(self.brainOpts);

            this.brain = new Worker('js/lib/external/rl.js');
            this.brain.onmessage = function (e) {
                let data = e.data;
                switch (data.cmd) {
                    case 'init':
                        if (data.msg === 'complete') {
                            self.state = self.env.startState();

                            self.env.reset();
                        }
                        break;
                    case 'act':
                        if (data.msg === 'complete') {
                            // run it through environment dynamics
                            var obs = self.sampleNextState(self.state, data.input);

                            // allow opportunity for the agent to learn
                            self.brain.postMessage({cmd: 'learn', input: obs.r});
                        }
                        break;
                    case 'learn':
                        if (data.msg === 'complete') {
                            self.Rarr[self.state] = obs.r;

                            // evolve environment to next state
                            self.state = obs.ns;
                            self.gridLocation = self.world.grid.getCellAt(self.sToX(self.state), self.sToY(self.state));

                            let x = self.gridLocation.coords.bottom.right.x - (self.world.grid.cellWidth / 2),
                                y = self.gridLocation.coords.bottom.right.y - (self.world.grid.cellHeight / 2);
                            self.position.set(x, y);

                            self.nStepsCounter += 1;
                            if (typeof obs.resetEpisode !== 'undefined') {
                                self.score += 1;
                                self.brain.postMessage({cmd: 'resetEpisode'});
                                // record the reward achieved
                                if (self.nStepsHistory.length >= self.nflot) {
                                    self.nStepsHistory = self.nStepsHistory.slice(1);
                                }
                                self.nStepsHistory.push(self.nStepsCounter);
                                self.nStepsCounter = 0;

                                self.gridLocation = self.world.grid.getCellAt(0, 0);
                                self.position.set(self.world.grid.cellWidth / 2, self.world.grid.cellHeight / 2);
                            }
                        }
                        break;
                    default:
                        console.log('Unknown command: ' + data.cmd + ' message:' + data.msg);
                        break;
                }
            };

            this.brain.post('init', {env: jEnv, opts: jOpts});
        }
    };

    /**
     * Agent's chance to act on the world
     * @param {Object} world
     */
    AgentRLTD.prototype.tick = function (world) {
        this.world = world;
        if (!this.worker) {
            // ask agent for an action
            let a = this.brain.act(this.state),
            // run it through environment dynamics
                obs = this.sampleNextState(this.state, a);

            // allow opportunity for the agent to learn
            this.brain.learn(obs.r);
            this.Rarr[this.state] = obs.r;

            // evolve environment to next state
            this.state = obs.ns;
            this.gridLocation = this.world.grid.getCellAt(this.sToX(this.state), this.sToY(this.state));

            let x = this.gridLocation.coords.bottom.right.x - (this.world.grid.cellWidth / 2),
                y = this.gridLocation.coords.bottom.right.y - (this.world.grid.cellHeight / 2);
            this.position.set(x, y);

            this.nStepsCounter += 1;
            if (typeof obs.resetEpisode !== 'undefined') {
                this.score += 1;
                this.brain.resetEpisode();
                // record the reward achieved
                if (this.nStepsHistory.length >= this.nflot) {
                    this.nStepsHistory = this.nStepsHistory.slice(1);
                }
                this.nStepsHistory.push(this.nStepsCounter);
                this.nStepsCounter = 0;

                this.gridLocation = this.world.grid.getCellAt(0, 0);
                this.position.set(this.world.grid.cellWidth / 2, this.world.grid.cellHeight / 2);
            }
        } else {
            this.post('act', this.state);
        }
    };

    global.AgentRLTD = AgentRLTD;

}(this));

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Agent.html">Agent</a></li><li><a href="AgentGA.html">AgentGA</a></li><li><a href="AgentRLDQN.html">AgentRLDQN</a></li><li><a href="AgentRLTD.html">AgentRLTD</a></li><li><a href="AgentTD.html">AgentTD</a></li><li><a href="Bitmap.html">Bitmap</a></li><li><a href="BruteCD.html">BruteCD</a></li><li><a href="Button.html">Button</a></li><li><a href="Camera.html">Camera</a></li><li><a href="Cell.html">Cell</a></li><li><a href="Chromosome.html">Chromosome</a></li><li><a href="CollisionDetector.html">CollisionDetector</a></li><li><a href="datGUI.html">datGUI</a></li><li><a href="DeterministPG.html">DeterministPG</a></li><li><a href="Display.html">Display</a></li><li><a href="DPAgent.html">DPAgent</a></li><li><a href="DQNAgent.html">DQNAgent</a></li><li><a href="Entity.html">Entity</a></li><li><a href="EntityRLDQN.html">EntityRLDQN</a></li><li><a href="ESPNet.html">ESPNet</a></li><li><a href="ESPTrainer.html">ESPTrainer</a></li><li><a href="Eye.html">Eye</a></li><li><a href="GATrainer.html">GATrainer</a></li><li><a href="Graph.html">Graph</a></li><li><a href="Grid.html">Grid</a></li><li><a href="GridCD.html">GridCD</a></li><li><a href="GridWorld.html">GridWorld</a></li><li><a href="HeCubex.html">HeCubex</a></li><li><a href="Hex.html">Hex</a></li><li><a href="HexGrid.html">HexGrid</a></li><li><a href="HexWorld.html">HexWorld</a></li><li><a href="Interactions.html">Interactions</a></li><li><a href="Map.html">Map</a></li><li><a href="Mat.html">Mat</a></li><li><a href="Maze.html">Maze</a></li><li><a href="MazeWorld.html">MazeWorld</a></li><li><a href="Menu.html">Menu</a></li><li><a href="Player.html">Player</a></li><li><a href="Point.html">Point</a></li><li><a href="PuckWorld.html">PuckWorld</a></li><li><a href="QuadCD.html">QuadCD</a></li><li><a href="QuadTree.html">QuadTree</a></li><li><a href="RecurrentReinforceAgent.html">RecurrentReinforceAgent</a></li><li><a href="RewardGraph.html">RewardGraph</a></li><li><a href="SimpleReinforceAgent.html">SimpleReinforceAgent</a></li><li><a href="Solver.html">Solver</a></li><li><a href="TDAgent.html">TDAgent</a></li><li><a href="Vec.html">Vec</a></li><li><a href="Wall.html">Wall</a></li><li><a href="WaterWorld.html">WaterWorld</a></li><li><a href="WaterWorldEX.html">WaterWorldEX</a></li><li><a href="WaterWorldGA.html">WaterWorldGA</a></li><li><a href="Window.html">Window</a></li><li><a href="World.html">World</a></li><li><a href="%257Bobject%257D%2520input.html">{object} input</a></li></ul><h3>Global</h3><ul><li><a href="global.html#clear">clear</a></li><li><a href="global.html#clone">clone</a></li><li><a href="global.html#divide">divide</a></li><li><a href="global.html#EZGUI">EZGUI</a></li><li><a href="global.html#findByAngle">findByAngle</a></li><li><a href="global.html#findByName">findByName</a></li><li><a href="global.html#findInsertNode">findInsertNode</a></li><li><a href="global.html#findOverlappingNodes">findOverlappingNodes</a></li><li><a href="global.html#initSensors">initSensors</a></li><li><a href="global.html#insert">insert</a></li><li><a href="global.html#isAndroid">isAndroid</a></li><li><a href="global.html#isChrome">isChrome</a></li><li><a href="global.html#isFirefox">isFirefox</a></li><li><a href="global.html#isGecko">isGecko</a></li><li><a href="global.html#isIE">isIE</a></li><li><a href="global.html#isIOS">isIOS</a></li><li><a href="global.html#isIPad">isIPad</a></li><li><a href="global.html#isIPhone">isIPhone</a></li><li><a href="global.html#isIPod">isIPod</a></li><li><a href="global.html#isKindle">isKindle</a></li><li><a href="global.html#isMobile">isMobile</a></li><li><a href="global.html#isOpera">isOpera</a></li><li><a href="global.html#isSafari">isSafari</a></li><li><a href="global.html#isTablet">isTablet</a></li><li><a href="global.html#isTV">isTV</a></li><li><a href="global.html#isWebKit">isWebKit</a></li><li><a href="global.html#resetSensors">resetSensors</a></li><li><a href="global.html#retrieve">retrieve</a></li><li><a href="global.html#Utility">Utility</a></li><li><a href="global.html#whoami">whoami</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Thu Dec 03 2015 10:30:02 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
